id: 3ea29e93-088a-4ca4-ae87-4f9aa3e360b6
title: Local Embedding Similarity Mismatch & Search Threshold Issue
summary: >-
  Debugging revealed that local embeddings in v4.0 produce negative cosine similarity scores,
  failing to meet the positive 0.3 search threshold. This is despite matching embedding dimensions
  and identical cosine similarity calculation logic to v3.6. The issue likely lies in unnormalized
  embeddings from the local LLM provider.
insights:
  - >-
    Local embeddings generate negative cosine similarity scores, preventing matches with a positive
    threshold.
  - Embedding dimensions match between query and stored data (768), ruling out dimensional mismatch.
  - >-
    Cosine similarity calculation logic is identical to v3.6, suggesting the problem is with the
    embedding normalization itself.
  - >-
    The hardcoded 100-protein search limit in v4.0 synthesizer.ts was removed to match v3.6's
    behavior.
  - Further investigation is needed to determine why local LLM embeddings are not normalized.
  - >-
    The negative similarity scores indicate a fundamental issue with how local LLMs are producing
    embeddings in this context.
tags:
  - '#local-llm'
  - '#embeddings'
  - '#cosine-similarity'
  - '#debugging'
  - '#v4.0-vs-v3.6'
  - '#normalization'
  - '#public'
  - '#embed:gemini'
  - '#embed:nomic-v1.5'
  - '#dna:Claude_Code_06-01-2026_to10-01-2026_txt'
  - '#synthesis:v4.5'
tier: convergence
coherence_score: 0.85
created_at: '2026-02-06T13:59:43.455Z'
source: synthesis
emotional_gradient: confusion → investigation → realization → problem-identification
