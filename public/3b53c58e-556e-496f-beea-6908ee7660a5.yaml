id: 3b53c58e-556e-496f-beea-6908ee7660a5
title: Local Embeddings & Negative Similarity Scores in Eidolon Mesh v4.0
summary: >-
  Eidolon Mesh v4.0 is encountering an issue where local embeddings, specifically from gemma3:12b,
  produce negative cosine similarity scores when queried. This prevents any proteins from passing
  the 0.3 similarity threshold, leading to zero candidate proteins being found. The issue is not a
  dimension mismatch (both are 768-dimensional) nor an incorrect embedding model, but likely stems
  from a lack of normalization in the generated local embeddings.
insights:
  - >-
    Local embeddings from gemma3:12b in v4.0 are generating negative cosine similarity scores
    (-0.0189 to -0.0422) against the query embedding.
  - >-
    The positive similarity threshold of 0.3 in pglite.ts is preventing any proteins from being
    selected, as negative scores will never exceed this positive value.
  - >-
    The cosine similarity calculation itself appears correct, but the input embeddings are likely
    not normalized, causing the negative results.
  - >-
    A hardcoded protein search limit of 100 in v4.0's synthesizer.ts was identified and removed to
    match v3.6's behavior, though this did not resolve the negative similarity issue.
  - >-
    The problem is isolated to v4.0's handling of local embeddings, as v3.6's local embedding
    implementation (if it exists) or other embeddings do not exhibit this behavior.
tags:
  - '#eidolonmesh'
  - '#local-llm'
  - '#embeddings'
  - '#cosine-similarity'
  - '#debugging'
  - '#gemma3'
  - '#normalization'
  - '#public'
  - '#embed:gemini-004'
  - '#embed:nomic-v1.5'
  - '#dna:Claude_Code_06-01-2026_to10-01-2026_txt'
  - '#synthesis:v4.5'
tier: convergence
coherence_score: 0.92
created_at: '2026-01-24T07:16:58.930Z'
source: synthesis
emotional_gradient: confusion → investigation → realization → clarity
